namespace = dharma_buddhism



#######################################
#									  #
# 	  MEDITATION RETREAT EVENTS       #
#									  #
#######################################


#######################################
# Meditation Retreat scripts
#######################################

scripted_trigger religious_decision_0201_can_meditate_in_terrain_trigger = {
	religious_decision_0201_has_two_meditation_options_trigger = no
	any_sub_realm_barony = {
		NOT = { this = root.capital_barony }
		title_province = {				
			terrain = $TERRAIN$
		}		
	}
}

scripted_trigger religious_decision_0201_has_two_meditation_options_trigger = {
	# Stops after we've found 2 good places for meditation (don't want to overload the player).
	calc_true_if = {
		amount >= 2
		has_character_flag = meditation_option_plains
		has_character_flag = meditation_option_hills
		has_character_flag = meditation_option_steppe
		has_character_flag = meditation_option_forest
		has_character_flag = meditation_option_drylands
		has_character_flag = meditation_option_mountains
		has_character_flag = meditation_option_wetlands
		has_character_flag = meditation_option_jungle
		has_character_flag = meditation_option_desert
	}
}

scripted_effect save_meditation_option_effect = {
	add_character_flag = meditation_option_$TERRAIN$
	random_sub_realm_barony = {
		limit = {
			NOT = { this = root.capital_barony }
			title_province = {				
				terrain = $TERRAIN$
			}
		}
		save_scope_as = $TERRAIN$_location
	}
}

scripted_effect meditate_at_location_effect = {
	if = {
		limit = {
			can_join_activities = yes
		}
		set_variable ={
			name = meditation_location
			value = scope:$TERRAIN$_location
		}
		scope:$TERRAIN$_location = {
			title_province = {	
				spawn_activity = {
					owner = root
					type = activity_meditation
				}	
			}
		}
		add_character_modifier = {
			modifier = meditating_in_seclusion_modifier
			days = meditation_duration
		}
	}
}

scripted_effect improve_meditation_skill = {
	if = {
		limit = {
			has_variable = meditation_experience
		}
		change_variable = {
			name = meditation_experience
			add = 1
		}
	}
	else = {
		set_variable = {
			name = meditation_experience
			value = 1
		}
	}
	custom_tooltip = dharma_buddhism.0211.experience
}

#######################################
# Meditation Retreat Base Events
#######################################

dharma_buddhism.100 = {# Departing for the monastasry
	type = character_event
	title = dharma_buddhism.100.t
	desc = dharma_buddhism.100.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}


	# Option 1: Departing for the monastary
	option = {
		name = dharma_buddhism.100.depart
	}

	# Option 2: On second thought, not today.
	option = {
		name = dharma_buddhism.100.optout
		flavor = dharma_buddhism.100.optout.flavor

		ai_chance = {
			base = 0
		}		
	}

	after = {
		remove_character_flag = meditation_option_plains
		remove_character_flag = meditation_option_hills
		remove_character_flag = meditation_option_steppe
		remove_character_flag = meditation_option_forest
		remove_character_flag = meditation_option_drylands
		remove_character_flag = meditation_option_mountains
		remove_character_flag = meditation_option_wetlands
		remove_character_flag = meditation_option_jungle
		remove_character_flag = meditation_option_desert
		remove_character_flag = planning_an_activity
	}
}

dharma_buddhism.101 = {# Arriving at the Monastary
	type = character_event
	title = dharma_buddhism.101.t
	desc = dharma_buddhism.101.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}


	option = {# Three month Retreat
		name = dharma_buddhism.101.three
		trigger_event = { id = dharma_buddhism.109 days = 90 }
		hidden_effect = {
			random_list = {
				20 = {
					trigger_event = { id = dharma_buddhism.102 days = 30 }
					trigger_event = { id = dharma_buddhism.109 days = 60 }
					trigger_event = { id = dharma_buddhism.105 days = 85 }
				}
				20 = {
					trigger_event = { id = dharma_buddhism.103 days = 30 }
					trigger_event = { id = dharma_buddhism.110 days = 60 }
					trigger_event = { id = dharma_buddhism.106 days = 85 }
				}
				20 = {
					trigger_event = { id = dharma_buddhism.104 days = 30 }
					trigger_event = { id = dharma_buddhism.111 days = 60 }
					trigger_event = { id = dharma_buddhism.102 days = 85 }
				}
				20 = {
					trigger_event = { id = dharma_buddhism.105 days = 30 }
					trigger_event = { id = dharma_buddhism.112 days = 60 }
					trigger_event = { id = dharma_buddhism.102 days = 85 }
				}
				20 = {
					trigger_event = { id = dharma_buddhism.106 days = 30 }
					trigger_event = { id = dharma_buddhism.114 days = 60 }
					trigger_event = { id = dharma_buddhism.103 days = 85 }
				}
			}
		}
	}
	option = {# Six Month Retreat
		name = dharma_buddhism.0201.six
		trigger_event = { id = dharma_buddhism.109 days = 182 }
		hidden_effect = {
			random_list = {
				20 = {
					trigger_event = { id = dharma_buddhism.102 days = 45 }
					trigger_event = { id = dharma_buddhism.103 days = 90 }
					trigger_event = { id = dharma_buddhism.109 days = 135 }
					trigger_event = { id = dharma_buddhism.110 days = 180 }			
				}
				20 = {
					trigger_event = { id = dharma_buddhism.103 days = 45 }
					trigger_event = { id = dharma_buddhism.104 days = 90 }
					trigger_event = { id = dharma_buddhism.110 days = 135 }
					trigger_event = { id = dharma_buddhism.111 days = 180 }	
				}
				20 = {
					trigger_event = { id = dharma_buddhism.104 days = 45 }
					trigger_event = { id = dharma_buddhism.105 days = 90 }
					trigger_event = { id = dharma_buddhism.111 days = 135 }
					trigger_event = { id = dharma_buddhism.112 days = 180 }	

				}
				20 = {
					trigger_event = { id = dharma_buddhism.105 days = 45 }
					trigger_event = { id = dharma_buddhism.106 days = 90 }
					trigger_event = { id = dharma_buddhism.112 days = 135 }
					trigger_event = { id = dharma_buddhism.113 days = 180 }	
				}
				20 = {
					trigger_event = { id = dharma_buddhism.106 days = 45 }
					trigger_event = { id = dharma_buddhism.107 days = 90 }
					trigger_event = { id = dharma_buddhism.113 days = 135 }
					trigger_event = { id = dharma_buddhism.114 days = 180 }
				}
			}
		}

	}
	option = {# Twelve Month Retreat-
		name = dharma_buddhism.0201.twelve
		trigger_event = { id = dharma_buddhism.109 days = 365 }
		hidden_effect = {
			random_list = {
				20 = {
					trigger_event = { id = dharma_buddhism.102 days = 73 }
					trigger_event = { id = dharma_buddhism.107 days = 146 }
					trigger_event = { id = dharma_buddhism.111 days = 219 }
					trigger_event = { id = dharma_buddhism.110 days = 292 }
					trigger_event = { id = dharma_buddhism.109 days = 350 }
					
				}
				20 = {
					trigger_event = { id = dharma_buddhism.103 days = 73 }
					trigger_event = { id = dharma_buddhism.102 days = 146 }
					trigger_event = { id = dharma_buddhism.113 days = 219 }
					trigger_event = { id = dharma_buddhism.111 days = 292 }
					trigger_event = { id = dharma_buddhism.112 days = 350 }
				}
				20 = {
					trigger_event = { id = dharma_buddhism.104 days = 73 }
					trigger_event = { id = dharma_buddhism.103 days = 146 }
					trigger_event = { id = dharma_buddhism.109 days = 219 }
					trigger_event = { id = dharma_buddhism.111 days = 292 }
					trigger_event = { id = dharma_buddhism.113 days = 350 }
				}
				20 = {
					trigger_event = { id = dharma_buddhism.105 days = 73 }
					trigger_event = { id = dharma_buddhism.108 days = 146 }
					trigger_event = { id = dharma_buddhism.110 days = 219 }
					trigger_event = { id = dharma_buddhism.112 days = 292 }
					trigger_event = { id = dharma_buddhism.114 days = 350 }
				}
				20 = {
					trigger_event = { id = dharma_buddhism.106 days = 73 }
					trigger_event = { id = dharma_buddhism.108 days = 146 }
					trigger_event = { id = dharma_buddhism.109 days = 219 }
					trigger_event = { id = dharma_buddhism.115 days = 292 }
					trigger_event = { id = dharma_buddhism.113 days = 350 }
				}
			}
		}
	}
	
}

#######################################
# Meditation Retreat General Events
#######################################

dharma_buddhism.102 = {# Back to basics
	type = character_event
	title = dharma_buddhism.102.t
	desc = dharma_buddhism.102.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}	

	option = {
		name = dharma_buddhism.102.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {

		}
	}
}

dharma_buddhism.103 = {# monastic food
	type = character_event
	title = dharma_buddhism.103.t
	desc = dharma_buddhism.103.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.103.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

dharma_buddhism.104 = {# Meditate with eyes shut
	type = character_event
	title = dharma_buddhism.104.t
	desc = dharma_buddhism.104.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.104.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

dharma_buddhism.105 = {# Uncomfortable robes!
	type = character_event
	title = dharma_buddhism.105.t
	desc = dharma_buddhism.105.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.105.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

dharma_buddhism.106 = {# Numb legs
	type = character_event
	title = dharma_buddhism.106.t
	desc = dharma_buddhism.106.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.106.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

#######################################
# Meditation Retreat Rare Events
#######################################

dharma_buddhism.107 = {# An exam
	type = character_event
	title = dharma_buddhism.107.t
	desc = dharma_buddhism.107.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.107.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

dharma_buddhism.108 = {# Master's wisdom
	type = character_event
	title = dharma_buddhism.108.t
	desc = dharma_buddhism.108.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.108.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

#######################################
# Meditation Retreat Novice Events
#######################################

dharma_buddhism.109 = {# Calmness and self-control
	type = character_event
	title = dharma_buddhism.109.t
	desc = dharma_buddhism.109.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.109.a
	}

	option = {
		name = dharma_buddhism.109.b
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

dharma_buddhism.110 = {# Distract self or not?
	type = character_event
	title = dharma_buddhism.110.t
	desc = dharma_buddhism.110.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.110.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}

	option = {
		name = dharma_buddhism.110.b
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

dharma_buddhism.111 = {# Whack!
	type = character_event
	title = dharma_buddhism.111.t
	desc = dharma_buddhism.111.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.111.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

dharma_buddhism.112 = {# Energized!
	type = character_event
	title = dharma_buddhism.112.t
	desc = dharma_buddhism.112.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.112.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

#######################################
# Meditation Retreat Experinced Events
#######################################

dharma_buddhism.113 = {# Going outside
	type = character_event
	title = dharma_buddhism.113.t
	desc = dharma_buddhism.113.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.113.a

	}
}

dharma_buddhism.114 = {# Questions and Answers
	type = character_event
	title = dharma_buddhism.114.t
	desc = dharma_buddhism.114.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.114.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

dharma_buddhism.115 = {# Heightened Senses
	type = character_event
	title = dharma_buddhism.115.t
	desc = dharma_buddhism.115.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = dharma_buddhism.115.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}
}

#######################################
# Meditation Retreat Ending Events
#######################################

dharma_buddhism.116 = {# Departing the Monastary for home
	type = character_event
	title = dharma_buddhism.116.t
	desc = dharma_buddhism.116.desc
	theme = faith
	override_background = {
		event_background = throne_room
	}
	left_portrait = root

	option = {
		name = dharma_buddhism.116.a
		stress_impact = {
			base = minor_stress_gain
			diligent = medium_stress_impact_loss
		}
		hidden_effect = {
			
		}
	}

	after = {
		# Remove character
		remove_character_flag = meditation_secret
		remove_character_flag = meditation_impatient
		remove_character_flag = meditation_epiphany
		remove_character_flag = meditation_fugue
		remove_character_flag = meditation_reflection
		remove_character_flag = meditation_major_stress_loss
		remove_character_flag = meditation_medium_stress_loss
		remove_character_flag = meditation_minor_stress_loss

		# Run the activity clean-up event.
		trigger_event = {
			id = dharma_buddhism.117
			days = 5
		}
	}
}

dharma_buddhism.117 = {# End meditation
	hidden = yes
	
	immediate = {
		scope:activity = {
			complete_activity = yes
		}
	}
}